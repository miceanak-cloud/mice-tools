<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>All-in-One Tools ‚Äî tool App</title>
  <style>
    :root{--bg:#ffffff;--card:#f8fafc;--muted:#555;--accent:#2563eb;--text:#111;--muted-bg:#f1f5f9}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:var(--bg);color:var(--text);min-height:100vh}
    header{padding:18px;text-align:center;border-bottom:1px solid #eef2f7}
    header h1{margin:0;font-size:22px;color:var(--accent)}
    header p{color:var(--muted);font-size:13px;margin-top:6px}
    .container{max-width:1200px;margin:0 auto;padding:18px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px}
    .card{background:var(--card);border:1px solid #e6eef8;padding:16px;border-radius:10px;cursor:pointer;transition:all .12s}
    .card:hover{border-color:var(--accent);box-shadow:0 6px 18px rgba(37,99,235,0.06)}
    .card h2{margin:0 0 6px;font-size:16px}
    .card p{margin:0;color:var(--muted);font-size:13px}
    .tool{display:none;padding:18px}
    .active{display:block}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    input,select,button,textarea{margin:6px 0;padding:8px 10px;border-radius:8px;border:1px solid #e6edf3;background:var(--muted-bg);color:var(--text)}
    button{background:var(--accent);color:#fff;border:none;padding:8px 14px;border-radius:8px;cursor:pointer}
    button.ghost{background:transparent;color:var(--accent);border:1px solid #e6eef8}
    footer{text-align:center;padding:12px;color:var(--muted);font-size:12px}
    .files{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px;margin-top:12px}
    .file-card{background:#fff;border:1px solid #eef2f7;padding:8px;border-radius:8px;display:flex;gap:8px;align-items:center}
    .thumb{width:56px;height:56px;border-radius:8px;object-fit:cover;background:#f8fafc;border:1px solid #eef2f7}
    canvas{max-width:100%}
    .small{font-size:12px;color:var(--muted)}
    pre{white-space:pre-wrap;background:#f8fafc;padding:10px;border-radius:8px;border:1px solid #eef2f7}
    .spinner{display:inline-block;width:18px;height:18px;border:3px solid #e6eef8;border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <!-- ffmpeg will be lazy-loaded when needed -->
</head>
<body>
  <header>
    <h1>All-in-One Tools ‚Äî Swiss Army App</h1>
    <p>Home dashboard ‚Äî click a card to open a category. Most tools run fully in your browser. (ffmpeg loaded on demand)</p>
  </header>

  <div class="container">
    <section id="home" class="grid">
      <div class="card" onclick="showCategory('image')"><h2>üñºÔ∏è Image Tools</h2><p>Converter, Compressor, Cropper</p></div>
      <div class="card" onclick="showCategory('media')"><h2>üé¨ Media Tools</h2><p>Video Converter, Audio Trimmer (ffmpeg lazy-load)</p></div>
      <div class="card" onclick="showCategory('calc')"><h2>üßÆ Calculators</h2><p>Age, EMI, SIP</p></div>
      <div class="card" onclick="showCategory('docs')"><h2>üìÑ Document Tools</h2><p>PDF convert/compress/merge, Word/Excel‚ÜíPDF, OCR</p></div>
    </section>

    <!-- Image Category -->
    <section id="image" class="tool">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2>üñºÔ∏è Image Tools</h2>
        <div><button class="ghost" onclick="backHome()">‚¨Ö Back</button></div>
      </div>

      <div class="row" style="margin-top:12px">
        <button onclick="showTool('img_converter')">Converter</button>
        <button onclick="showTool('img_compressor')">Compressor</button>
        <button onclick="showTool('img_cropper')">Cropper</button>
      </div>

      <!-- Converter -->
      <div id="img_converter" class="tool-panel" style="margin-top:12px;display:none">
        <h3>Image Converter</h3>
        <input id="convFiles" type="file" accept="image/*" multiple>
        <div class="row"><select id="convFormat"><option value="image/png">PNG</option><option value="image/jpeg">JPEG</option><option value="image/webp">WebP</option><option value="image/bmp">BMP</option></select>
        <label class="small">Quality <input id="convQuality" type="range" min="0.1" max="1" step="0.05" value="0.92"></label>
        <input id="convMaxDim" type="number" placeholder="Max dimension (px)" style="width:160px">
        <button id="convBtn">Convert & Download</button></div>
        <div id="convFilesList" class="files"></div>
      </div>

      <!-- Compressor -->
      <div id="img_compressor" class="tool-panel" style="margin-top:12px;display:none">
        <h3>Image Compressor</h3>
        <input id="compFile" type="file" accept="image/*">
        <label class="small">Quality <input id="compQuality" type="range" min="0.1" max="1" step="0.05" value="0.7"></label>
        <input id="compMaxDim" type="number" placeholder="Max dimension (px)" style="width:160px">
        <button onclick="compressImage()">Compress & Download</button>
        <div id="compPreview" style="margin-top:12px"></div>
      </div>

      <!-- Cropper -->
      <div id="img_cropper" class="tool-panel" style="margin-top:12px;display:none">
        <h3>Image Cropper</h3>
        <input id="cropFile" type="file" accept="image/*">
        <div style="position:relative;display:inline-block;margin-top:8px">
          <canvas id="cropCanvas" style="border:1px solid #eef2f7;max-width:800px"></canvas>
          <div id="cropRect" style="position:absolute;border:2px dashed rgba(37,99,235,0.9);display:none;pointer-events:none"></div>
        </div>
        <div class="row" style="margin-top:8px"><button onclick="applyCrop()">Crop & Download</button><button onclick="resetCrop()">Reset</button></div>
        <div class="small" style="margin-top:8px">Drag on the image to draw a crop rectangle, then click Crop.</div>
      </div>
    </section>

    <!-- Media Category -->
    <section id="media" class="tool">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2>üé¨ Media Tools</h2>
        <div><button class="ghost" onclick="backHome()">‚¨Ö Back</button></div>
      </div>
      <div class="row" style="margin-top:12px">
        <button onclick="showTool('media_video')">Video Converter</button>
        <button onclick="showTool('media_audio')">Audio Trimmer</button>
      </div>

      <div id="media_video" class="tool-panel" style="margin-top:12px;display:none">
        <h3>Video Converter (ffmpeg.wasm lazy-load)</h3>
        <div class="small">ffmpeg will be loaded only when needed. This may take a few seconds.</div>
        <div class="row" style="margin-top:8px"><input id="videoFile" type="file" accept="video/*"><select id="videoOutFormat"><option value="mp4">MP4</option><option value="webm">WebM</option><option value="gif">GIF</option></select>
        <button id="loadFfmpegBtn" onclick="ensureFfmpeg()">Load ffmpeg</button>
        <button onclick="convertVideo()">Convert</button></div>
        <div id="videoStatus" class="small" style="margin-top:8px"></div>
        <div id="videoResult" style="margin-top:12px"></div>
      </div>

      <div id="media_audio" class="tool-panel" style="margin-top:12px;display:none">
        <h3>Audio Trimmer (ffmpeg)</h3>
        <div class="row" style="margin-top:8px"><input id="audioFile" type="file" accept="audio/*"><label>Start(s): <input id="audioStart" type="number" value="0" style="width:100px"></label><label>End(s, 0 = till end): <input id="audioEnd" type="number" value="0" style="width:100px"></label></div>
        <div class="row" style="margin-top:8px"><button onclick="trimAudioFfmpeg()">Trim & Download</button><button onclick="loadFfmpegIfNeeded()">Load ffmpeg</button></div>
        <div id="audioStatus" class="small" style="margin-top:8px"></div>
        <audio id="audioPreview" controls style="display:block;margin-top:8px"></audio>
      </div>
    </section>

    <!-- Calculators -->
    <section id="calc" class="tool">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2>üßÆ Calculators</h2>
        <div><button class="ghost" onclick="backHome()">‚¨Ö Back</button></div>
      </div>
      <div class="row" style="margin-top:12px"><button onclick="showTool('calc_age')">Age</button><button onclick="showTool('calc_emi')">EMI</button><button onclick="showTool('calc_sip')">SIP</button></div>

      <div id="calc_age" class="tool-panel" style="margin-top:12px;display:none"><h3>Age Calculator</h3><label>Birthdate: <input id="birthDate" type="date"></label><button onclick="calcAge()">Calculate</button><p id="ageRes"></p></div>
      <div id="calc_emi" class="tool-panel" style="margin-top:12px;display:none"><h3>EMI Calculator</h3><label>Loan Amount: <input id="loanAmt" type="number"></label><label>Annual Rate %: <input id="loanRate" type="number"></label><label>Tenure (months): <input id="loanTenure" type="number"></label><button onclick="calcEMI()">Calculate</button><p id="emiRes"></p></div>
      <div id="calc_sip" class="tool-panel" style="margin-top:12px;display:none"><h3>SIP Calculator</h3><label>Monthly Invest: <input id="sipAmt" type="number"></label><label>Expected Return % p.a.: <input id="sipRate" type="number"></label><label>Years: <input id="sipYears" type="number"></label><button onclick="calcSIP()">Calculate</button><p id="sipRes"></p></div>
    </section>

    <!-- Documents Category -->
    <section id="docs" class="tool">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2>üìÑ Document & File Tools</h2>
        <div><button class="ghost" onclick="backHome()">‚¨Ö Back</button></div>
      </div>

      <div class="row" style="margin-top:12px;flex-wrap:wrap">
        <button onclick="showTool('doc_pdfconv')">PDF Converter</button>
        <button onclick="showTool('doc_pdfcomp')">PDF Compressor</button>
        <button onclick="showTool('doc_pdfmerge')">PDF Merge</button>
        <button onclick="showTool('doc_word2pdf')">Word ‚Üí PDF</button>
        <button onclick="showTool('doc_excel2pdf')">Excel ‚Üí PDF</button>
        <button onclick="showTool('doc_text2pdf')">Text ‚Üí PDF</button>
        <button onclick="showTool('doc_ocr')">OCR</button>
      </div>

      <div id="doc_pdfconv" class="tool-panel" style="margin-top:12px;display:none"><h3>PDF ‚Üí Images (demo)</h3><input id="docPdfFile" type="file" accept="application/pdf"><button onclick="convertPdfToImages()">Convert</button><div id="pdfImages"></div></div>
      <div id="doc_pdfcomp" class="tool-panel" style="margin-top:12px;display:none"><h3>PDF Compressor</h3><input id="docPdfCompressFile" type="file" accept="application/pdf"><button onclick="compressPdf()">Compress</button><a id="compressedLink"></a></div>
      <div id="doc_pdfmerge" class="tool-panel" style="margin-top:12px;display:none"><h3>PDF Merge</h3><input id="docMergeFiles" type="file" accept="application/pdf" multiple><button onclick="mergePdfs()">Merge</button><a id="mergedLink"></a></div>
      <div id="doc_word2pdf" class="tool-panel" style="margin-top:12px;display:none"><h3>Word ‚Üí PDF (basic)</h3><input id="docWordFile" type="file" accept=".doc,.docx"><button onclick="wordToPdf()">Convert</button></div>
      <div id="doc_excel2pdf" class="tool-panel" style="margin-top:12px;display:none"><h3>Excel ‚Üí PDF (CSV demo)</h3><input id="docExcelFile" type="file" accept=".csv"><button onclick="excelToPdf()">Convert</button></div>
      <div id="doc_text2pdf" class="tool-panel" style="margin-top:12px;display:none"><h3>Text ‚Üí PDF</h3><textarea id="docTextInput" placeholder="Enter text..."></textarea><button onclick="textToPdf()">Generate</button></div>
      <div id="doc_ocr" class="tool-panel" style="margin-top:12px;display:none"><h3>OCR (Image ‚Üí Text)</h3><input id="docOcrFile" type="file" accept="image/*"><button onclick="runOcr()">Extract</button><pre id="ocrOut"></pre></div>
    </section>

    <footer>All processing happens locally in your browser. For heavy media encoding we use ffmpeg.wasm (lazy-loaded).</footer>
  </div>

  <script>
    // Navigation helpers
    function hideAllToolPanels(){ document.querySelectorAll('.tool-panel').forEach(p=>p.style.display='none'); }
    function showCategory(id){ hideAllToolPanels(); document.getElementById('home').style.display='none'; document.querySelectorAll('.tool').forEach(t=>t.classList.remove('active')); document.getElementById(id).classList.add('active'); window.scrollTo(0,0); }
    function backHome(){ hideAllToolPanels(); document.querySelectorAll('.tool').forEach(t=>t.classList.remove('active')); document.getElementById('home').style.display='grid'; window.scrollTo(0,0); }
    function showTool(id){ hideAllToolPanels(); document.getElementById(id).style.display='block'; window.scrollTo(0,0); }
    document.getElementById('home').style.display='grid';

    // -------- Image Tools --------
    // Converter
    const convFilesEl = document.getElementById('convFiles'); const convFilesList = document.getElementById('convFilesList'); const convBtn = document.getElementById('convBtn');
    if(convFilesEl){ convFilesEl.addEventListener('change', ()=>{ convFilesList.innerHTML=''; for(const f of convFilesEl.files){ const c=document.createElement('div'); c.className='file-card'; const url=URL.createObjectURL(f); c.innerHTML=`<img class="thumb" src="${url}"/><div><b>${f.name}</b><div class="small muted">${Math.round(f.size/1024)} KB</div></div>`; convFilesList.appendChild(c); setTimeout(()=>URL.revokeObjectURL(url),60000); } }); }
    if(convBtn){ convBtn.addEventListener('click', async ()=>{ if(!convFilesEl || !convFilesEl.files.length) return alert('Choose images'); const outType = document.getElementById('convFormat').value; const quality = Number(document.getElementById('convQuality').value); const maxDim = Number(document.getElementById('convMaxDim').value) || null; for(const f of convFilesEl.files){ try{ const blob = await convertImageFile(f,outType,quality,maxDim); const ext = mimeToExt(outType); downloadBlob(blob, f.name.replace(/\.[^/.]+$/,'') + '.'+ext); }catch(e){console.error(e); alert('Conversion failed for '+f.name);} } }); }
    async function convertImageFile(file, outType, quality, maxDim){ const img = await createImageBitmap(file); let w=img.width,h=img.height; if(maxDim){ const ratio = Math.min(1, maxDim/Math.max(w,h)); w=Math.round(w*ratio); h=Math.round(h*ratio);} const canvas=document.createElement('canvas'); canvas.width=w; canvas.height=h; const ctx=canvas.getContext('2d'); ctx.drawImage(img,0,0,w,h); return await new Promise((res,rej)=>canvas.toBlob(b=>b?res(b):rej(new Error('toBlob failed')), outType, quality)); }
    function mimeToExt(m){ switch(m){case 'image/png': return 'png'; case 'image/jpeg': return 'jpg'; case 'image/webp': return 'webp'; case 'image/bmp': return 'bmp'; default: return 'img';}}
    function downloadBlob(blob, filename){ const a=document.createElement('a'); const url=URL.createObjectURL(blob); a.href=url; a.download=filename; document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); },5000);} 

    // Compressor
    async function compressImage(){ const inp=document.getElementById('compFile'); if(!inp || !inp.files.length) return alert('Choose image'); const f=inp.files[0]; const q=Number(document.getElementById('compQuality').value); const maxDim=Number(document.getElementById('compMaxDim').value)||null; try{ const blob = await convertImageFile(f,'image/jpeg',q,maxDim); const url=URL.createObjectURL(blob); document.getElementById('compPreview').innerHTML=`<a href="${url}" download="compressed.jpg"><img src="${url}" style="max-width:200px"></a>`; setTimeout(()=>URL.revokeObjectURL(url),60000);}catch(e){console.error(e); alert('Compression failed');}}

    // Cropper
    const cropFile = document.getElementById('cropFile'); const cropCanvas = document.getElementById('cropCanvas'); const cropRectEl=document.getElementById('cropRect'); let cropImg=null, cropCtx=null, isDragging=false, startX=0, startY=0, rect=null;
    if(cropFile){ cropFile.addEventListener('change', async e=>{ const f=e.target.files[0]; if(!f) return; cropImg = await createImageBitmap(f); cropCanvas.width = cropImg.width; cropCanvas.height = cropImg.height; cropCanvas.style.width = Math.min(cropImg.width,800)+'px'; cropCtx = cropCanvas.getContext('2d'); cropCtx.clearRect(0,0,cropCanvas.width,cropCanvas.height); cropCtx.drawImage(cropImg,0,0); rect=null; cropRectEl.style.display='none'; }); }
    function getCanvasRect(){ return cropCanvas.getBoundingClientRect(); }
    if(cropCanvas){ cropCanvas.addEventListener('mousedown', e=>{ if(!cropImg) return; isDragging=true; const r=getCanvasRect(); startX = Math.round((e.clientX - r.left) * (cropCanvas.width / r.width)); startY = Math.round((e.clientY - r.top) * (cropCanvas.height / r.height)); cropRectEl.style.display='block'; }); }
    window.addEventListener('mousemove', e=>{ if(!isDragging || !cropImg) return; const r=getCanvasRect(); const x = Math.round((e.clientX - r.left) * (cropCanvas.width / r.width)); const y = Math.round((e.clientY - r.top) * (cropCanvas.height / r.height)); const x0=Math.min(startX,x), y0=Math.min(startY,y), w=Math.abs(x-startX), h=Math.abs(y-startY); rect={x:x0,y:y0,w,h}; const scale = r.width / cropCanvas.width; cropRectEl.style.left = (x0*scale)+'px'; cropRectEl.style.top = (y0*scale)+'px'; cropRectEl.style.width = (w*scale)+'px'; cropRectEl.style.height = (h*scale)+'px'; });
    window.addEventListener('mouseup', ()=>{ if(isDragging) isDragging=false; });
    function applyCrop(){ if(!rect || !cropImg) return alert('Draw a crop rectangle first'); const out=document.createElement('canvas'); out.width=rect.w; out.height=rect.h; const octx=out.getContext('2d'); octx.drawImage(cropCanvas,rect.x,rect.y,rect.w,rect.h,0,0,rect.w,rect.h); out.toBlob(b=>{ if(!b) return alert('Crop failed'); downloadBlob(b,'cropped.png'); }, 'image/png'); }
    function resetCrop(){ if(cropImg && cropCtx){ cropCtx.clearRect(0,0,cropCanvas.width,cropCanvas.height); cropCtx.drawImage(cropImg,0,0); rect=null; cropRectEl.style.display='none'; } }

    // -------- Media Tools (ffmpeg lazy) --------
    let ffmpegLoaded=false; let ffmpegReady=false; let FFmpegLib=null; async function loadFfmpeg(){ if(ffmpegLoaded) return; ffmpegLoaded=true; const s=document.createElement('script'); s.src='https://unpkg.com/@ffmpeg/ffmpeg@0.11.7/dist/ffmpeg.min.js'; document.head.appendChild(s); await new Promise(res=>s.onload=res); FFmpegLib = window; }
    async function ensureFfmpeg(){ const status=document.getElementById('videoStatus'); try{ status.innerHTML='<span class="spinner"></span> Loading ffmpeg...'; await loadFfmpeg(); const createFFmpeg = (window && window.createFFmpeg) ? window.createFFmpeg : null; const fetchFile = (window && window.fetchFile) ? window.fetchFile : null; if(!createFFmpeg || !fetchFile) throw new Error('ffmpeg createFFmpeg/fetchFile not available'); window._createFFmpeg = createFFmpeg; window._fetchFile = fetchFile; window.ffmpeg = createFFmpeg({ log:true }); await window.ffmpeg.load(); ffmpegReady=true; status.textContent='ffmpeg ready'; }catch(e){ console.error(e); status.textContent='Failed to load ffmpeg: '+e.message; } }
    function loadFfmpegIfNeeded(){ if(ffmpegReady) return alert('ffmpeg already loaded'); ensureFfmpeg(); }

    async function convertVideo(){ const fileInp=document.getElementById('videoFile'); if(!fileInp || !fileInp.files.length) return alert('Choose video'); const outFormat=document.getElementById('videoOutFormat').value; const status=document.getElementById('videoStatus'); const result=document.getElementById('videoResult'); result.innerHTML=''; try{ if(!ffmpegReady){ await ensureFfmpeg(); if(!ffmpegReady) return; }
        const file=fileInp.files[0]; status.textContent='Preparing...'; const nameIn='in'+Date.now()+getExt(file.name); const nameOut='out.'+outFormat; const data = await window._fetchFile(file); window.ffmpeg.FS('writeFile', nameIn, data); status.textContent='Converting...'; if(outFormat==='mp4'){ await window.ffmpeg.run('-i',nameIn,'-c:v','libx264','-preset','veryfast','-crf','23',nameOut); }
        else if(outFormat==='webm'){ await window.ffmpeg.run('-i',nameIn,'-c:v','libvpx-vp9','-crf','30','-b:v','0',nameOut); }
        else if(outFormat==='gif'){ await window.ffmpeg.run('-i',nameIn,'-vf','fps=10,scale=640:-1:flags=lanczos',nameOut); }
        const outData=window.ffmpeg.FS('readFile',nameOut); const blob=new Blob([outData.buffer],{type: outFormat==='mp4'?'video/mp4': outFormat==='webm'?'video/webm':'image/gif'}); const url=URL.createObjectURL(blob); result.innerHTML=`<a href="${url}" download="converted.${outFormat}">Download converted</a><br><video src="${url}" controls style="max-width:320px"></video>`; status.textContent='Done'; try{ window.ffmpeg.FS('unlink', nameIn); window.ffmpeg.FS('unlink', nameOut); }catch(e){}
      }catch(e){ console.error(e); status.textContent='Conversion failed: '+e.message; }
    }
    function getExt(name){ const m = name.match(/\.[^/.]+$/); return m?m[0]:'.mp4'; }

    // Audio trim via ffmpeg
    async function trimAudioFfmpeg(){ const fileInp=document.getElementById('audioFile'); if(!fileInp || !fileInp.files.length) return alert('Choose audio'); const start = document.getElementById('audioStart').value || 0; const end = document.getElementById('audioEnd').value || 0; const status=document.getElementById('audioStatus'); const preview=document.getElementById('audioPreview'); try{ if(!ffmpegReady){ await ensureFfmpeg(); if(!ffmpegReady) return; }
        const file=fileInp.files[0]; const inName='audin'+Date.now()+getExt(file.name); const outName='audout.mp3'; const data = await window._fetchFile(file); window.ffmpeg.FS('writeFile', inName, data); status.textContent='Trimming...'; if(Number(end)>0){ await window.ffmpeg.run('-i',inName,'-ss',String(start),'-to',String(end),'-c','copy',outName); } else { await window.ffmpeg.run('-i',inName,'-ss',String(start),'-c','copy',outName); }
        const outData=window.ffmpeg.FS('readFile',outName); const blob=new Blob([outData.buffer],{type:'audio/mp3'}); const url=URL.createObjectURL(blob); preview.src=url; const a=document.createElement('a'); a.href=url; a.download='trimmed.mp3'; a.click(); status.textContent='Done'; try{ window.ffmpeg.FS('unlink',inName); window.ffmpeg.FS('unlink',outName); }catch(e){}
      }catch(e){ console.error(e); status.textContent='Audio trim failed: '+e.message; }
    }

    // -------- Calculators --------
    function calcAge(){ const v=document.getElementById('birthDate').value; if(!v) return alert('Choose date'); const dob=new Date(v); const now=new Date(); if(dob>now) return alert('Birthdate in future'); let years=now.getFullYear()-dob.getFullYear(); let months=now.getMonth()-dob.getMonth(); let days=now.getDate()-dob.getDate(); if(days<0){ months--; const prev=new Date(now.getFullYear(),now.getMonth(),0); days+=prev.getDate(); } if(months<0){ years--; months+=12; } document.getElementById('ageRes').textContent=`${years} years, ${months} months, ${days} days`; }
    function calcEMI(){ const p=Number(document.getElementById('loanAmt').value); const annual=Number(document.getElementById('loanRate').value); const n=Number(document.getElementById('loanTenure').value); if(!p||!n) return alert('Enter loan and tenure'); const r=annual/12/100; let emi; if(r===0) emi=p/n; else emi=(p*r*Math.pow(1+r,n))/(Math.pow(1+r,n)-1); const total=emi*n; const interest=total-p; document.getElementById('emiRes').textContent=`EMI: ${emi.toFixed(2)} | Total: ${total.toFixed(2)} | Interest: ${interest.toFixed(2)}`; }
    function calcSIP(){ const amt=Number(document.getElementById('sipAmt').value); const annual=Number(document.getElementById('sipRate').value); const years=Number(document.getElementById('sipYears').value); if(!amt||!years) return alert('Enter amount and years'); const r=annual/12/100; const m=years*12; let fv; if(r===0) fv=amt*m; else fv=amt*((Math.pow(1+r,m)-1)/r); document.getElementById('sipRes').textContent=`Future Value: ${fv.toFixed(2)}`; }

    // -------- Document Tools (pdf-lib, tesseract) --------
    async function convertPdfToImages(){ const f=document.getElementById('docPdfFile').files[0]; if(!f) return alert('Choose PDF'); const arr=await f.arrayBuffer(); const pdf=await PDFLib.PDFDocument.load(arr); const n=pdf.getPageCount(); const out=document.getElementById('pdfImages'); out.innerHTML=''; for(let i=0;i<n;i++){ const newD=await PDFLib.PDFDocument.create(); const [p]=await newD.copyPages(pdf,[i]); newD.addPage(p); const dataUri=await newD.saveAsBase64({dataUri:true}); const iframe=document.createElement('iframe'); iframe.src=dataUri; iframe.width=300; iframe.height=400; out.appendChild(iframe); } }
    async function compressPdf(){ const f=document.getElementById('docPdfCompressFile').files[0]; if(!f) return alert('Choose PDF'); const arr=await f.arrayBuffer(); const pdf=await PDFLib.PDFDocument.load(arr); const bytes=await pdf.save(); const blob=new Blob([bytes],{type:'application/pdf'}); const url=URL.createObjectURL(blob); const link=document.getElementById('compressedLink'); link.href=url; link.download='compressed.pdf'; link.textContent='Download Compressed PDF'; }
    async function mergePdfs(){ const files=document.getElementById('docMergeFiles').files; if(!files.length) return alert('Choose PDFs'); const merged=await PDFLib.PDFDocument.create(); for(const file of files){ const arr=await file.arrayBuffer(); const pdf=await PDFLib.PDFDocument.load(arr); const pages=await merged.copyPages(pdf,pdf.getPageIndices()); pages.forEach(p=>merged.addPage(p)); } const bytes=await merged.save(); const blob=new Blob([bytes],{type:'application/pdf'}); const url=URL.createObjectURL(blob); const link=document.getElementById('mergedLink'); link.href=url; link.download='merged.pdf'; link.textContent='Download Merged PDF'; }
    async function wordToPdf(){ const f=document.getElementById('docWordFile').files[0]; if(!f) return alert('Choose Word file'); const text=await f.text(); const pdf=await PDFLib.PDFDocument.create(); const page=pdf.addPage([600,800]); page.drawText(text.substring(0,3000),{x:50,y:750,size:12,maxWidth:500}); const bytes=await pdf.save(); const blob=new Blob([bytes],{type:'application/pdf'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='word.pdf'; a.click(); }
    async function excelToPdf(){ const f=document.getElementById('docExcelFile').files[0]; if(!f) return alert('Choose CSV'); const text=await f.text(); const lines=text.split(/\r?\n/); const pdf=await PDFLib.PDFDocument.create(); let page=pdf.addPage([600,800]); let y=750; for(const line of lines){ page.drawText(line,{x:50,y,size:10}); y-=14; if(y<50){ page=pdf.addPage([600,800]); y=750; } } const bytes=await pdf.save(); const blob=new Blob([bytes],{type:'application/pdf'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='excel.pdf'; a.click(); }
    async function textToPdf(){ const txt=document.getElementById('docTextInput').value; if(!txt.trim()) return alert('Enter text'); const pdf=await PDFLib.PDFDocument.create(); const page=pdf.addPage([600,800]); page.drawText(txt,{x:50,y:750,size:12,maxWidth:500}); const bytes=await pdf.save(); const blob=new Blob([bytes],{type:'application/pdf'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='text.pdf'; a.click(); }
    async function runOcr(){ const f=document.getElementById('docOcrFile').files[0]; if(!f) return alert('Choose image'); document.getElementById('ocrOut').textContent='Running OCR...'; try{ const { data:{ text } } = await Tesseract.recognize(f,'eng'); document.getElementById('ocrOut').textContent=text; }catch(e){ console.error(e); document.getElementById('ocrOut').textContent='OCR failed: '+e.message; } }
  </script>
</body>
</html>
